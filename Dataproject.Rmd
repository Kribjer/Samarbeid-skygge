---
title: "Final Dataproject"
author: "skyggemenn inc."
date: "24/09/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
rm(list = ls())

library(dplyr)
library(ggplot2)
library(tidyverse)
library(gapminder)
library(gganimate)
library(hrbrthemes) # ikke sikker på om denne trenger å være med 
library(png)
library(gifski)
library(magick)
library(broom)
library(plotly)
library(crosstalk)
library(R2HTML)
packageVersion("plotly")


```

```{r, include=FALSE}
#Laster opp og rydder HDI filen
hdi <- read.csv("human-development-index.csv")
hdi <- rename(hdi, "Country" = "Entity")
hdi <- rename(hdi, "Value" = "X..0.1..higher.values.are.better..")
hdi <- hdi[ ,-2]
```

```{r, include=FALSE}
#Laster opp og rydder renewable energy filen

energy <- read.csv("modern-renewable-energy-consumption.csv")
energy <- rename(energy, "Country" = "Entity")
energy <- rename(energy, "Hydro" = "Hydropower..terawatt.hours.")
energy <- rename(energy, "Wind" = "Wind..terawatt.hours.")
energy <- rename(energy, "Solar" = "Solar..terawatt.hours.")
energy <- rename(energy, "Other renewables" = "Other.renewables..modern.biofuels..geothermal..wave...tidal...terawatt.hours.")
energy <- energy[ ,-2]

energy$TotalenergyUse <- rowSums(energy[, c("Hydro", "Wind", "Solar", "Other renewables")], na.rm=T)

energy <- energy[ ,-3:-6]

#Lager plot for energy world


worldenergy <- energy %>%
  filter(Country == "World")

ggplot(worldenergy, aes(x = Year, y = TotalenergyUse)) +
  geom_line()+
  ggtitle("World energy use")

#Energy Africa

africaenergy <- energy %>%
  filter(Country == "Africa")

ggplot(africaenergy, aes(x = Year, y = TotalenergyUse))+
  geom_line()+
  ggtitle("Africa energy use")

#Energy Europe

europeEnergy <- energy %>%
  filter(Country == "European Union")

ggplot(europeEnergy, aes(x = Year, y = TotalenergyUse))+
  geom_line()+
  ggtitle("European Union energy use")

#Energy Asia

asiaenergy <- energy %>%
  filter(Country == "Asia Pacific")

ggplot(asiaenergy, aes(x = Year, y = TotalenergyUse))+
  geom_line()+
  ggtitle("Asia energy use")

#Energy North America

americaenergy <- energy %>%
  filter(Country == "North America")

ggplot(americaenergy, aes(x = Year, y = TotalenergyUse))+
  geom_line()+
  ggtitle("North America Energy use")

#Energy China

chinaenergy <- energy %>%
  filter(Country == "China")

#Total energy for easy viewing

energyview <- energy



```

```{r, include=FALSE}
#Laster opp gdp percap filen og rydder den

GdpPercap <- read.csv("real-gdp-per-capita-PWT.csv")

GdpPercap <- rename(GdpPercap, "Country" = "Entity", "Year" = "Year", "GdpPercap" = "GDP.per.capita..2011.international....PPP.adjusted.US...")

GdpPercap <- GdpPercap[ , -2]

GdpUS <- GdpPercap %>%
  filter(Country == "United States")

ggplot(GdpUS, aes(x = Year, y = GdpPercap)) +
  geom_line() +
  ggtitle("North America GDP per capita")

GdpChina <- GdpPercap %>%
  filter(Country == "China")



#Tester å sette gdppercap med totalenergy use for USA. Kunne startet den lavere og på samme punkt på y aksen, men det er ingen korrelasjon uansett.
ggplot() +
  geom_line(data = GdpUS, aes(y = GdpUS$GdpPercap, x = Year)) +
  geom_line(data = americaenergy, aes(y = americaenergy$TotalenergyUse, x = Year))


```

```{r, include=FALSE}
#China alle plots

ggplot(GdpChina, aes(x = Year, y = GdpPercap)) +
  geom_line() +
  ggtitle("China GDP per capita")

ggplot(chinaenergy, aes(x = Year, y = TotalenergyUse))+
  geom_line()+
  ggtitle("China Energy use")

chinahdi <- hdi %>%
  filter(Country == "China")

ggplot(chinahdi, aes(x = Year, y = Value)) +
  geom_line() +
  ggtitle("China HDI")


```

```{r, include=FALSE}
#India, for å sjekke om populasjon kan forklare økt bruk av alternativ energi

indiaenergy <- energy %>%
  filter(Country == "India")

ggplot(indiaenergy, aes(x = Year, y = TotalenergyUse)) +
  geom_line() +
  ggtitle("India energy use")

indiaGdp <- GdpPercap %>%
  filter(Country == "India")

ggplot(indiaGdp, aes(x = Year, y = GdpPercap)) +
  geom_line() +
  ggtitle("India GdpPercap")



```


```{r, include=FALSE}
# ANIMERT GRAF AV GDP-PER-CAPITA 

gifski_renderer(file = tempfile(fileext = ".gif"), loop = TRUE,
  width = NULL, height = NULL)

file_renderer(dir = ".", prefix = "gganim_plot", overwrite = FALSE)

animplot <- ggplot(GdpPercap, aes(x=Year , y=GdpPercap, color=Country)) + 
  geom_line() + 
  geom_point() + 
  ggtitle("Gdp per capita by country from 1950 to 2018") + 
  ylab("Gdp per capita") +
  transition_reveal(Year)+
  theme_ft_rc()



```

```{r, include=FALSE}
#Uploading and fixing the population file for easy data wrangling

Population <- read.csv("population-figures-by-country-csv_csv.csv")

Population <- gather(Population, Year, Population, Year_1960:Year_2016)

Population$Year <- substring(Population$Year, 6, 9)

Population$Year <- as.numeric(Population$Year)

Population <- Population[-1:-1315, ]

Population <- Population [, -2]

#Merging it together with energyview to get Per capita

Totalpop <- merge(Population, energyview)

totalprcap <- Totalpop %>%
  group_by(Year, Country) %>%
  summarise(Prcap = TotalenergyUse/Population)

chinatest <- totalprcap %>%
  filter(Country == "China")

chinapop <- Population %>%
  filter(Country == "China")

chinatotal <- merge(chinaenergy, chinapop)

chinatotal <- chinatotal %>%
  group_by(Year) %>%
  summarise(EnergyprCap = TotalenergyUse/Population)

ggplot(chinatotal, aes(x = Year, y = EnergyprCap)) +
  geom_line()
```

```{r, include=FALSE}
#Heads (top5) for each category

Continents <- c("Non-OECD", "World", "OECD", "Asia Pacific", "Europe & Eurasia", "North America", "European Union", "South & Central America", "CIS")

#Fixing for 2016 on prcap energyuse
prcap2016 <- totalprcap %>%
  filter(Year == 2016)


Headprcap <- prcap2016[order(-prcap2016$Prcap), ]
head(unique(Headprcap$Country, 5))

#Removing continents for energyview. usinc c() didnt work so i had to force it.
energy2016 <- energyview %>%
  filter(Year == 2016)

energyview <- energyview %>%
  filter(Country != "Non-OECD") %>%
  filter(Country != "World") %>%
  filter(Country != "OECD") %>%
  filter(Country != "Asia Pacific") %>%
  filter(Country != "Europe & Eurasia") %>%
  filter(Country != "North America") %>%
  filter(Country != "European Union") %>%
  filter(Country != "South & Central America") %>%
  filter(Country != "CIS") %>%
  filter(Country != "Africa")

#Top 5 Total energy use 2016
Headtotal <- energy2016[order(-energy2016$TotalenergyUse), ] 
head(unique(Headtotal$Country, 5))

```

```{r, include=FALSE}
#Growth rate energyprcap function

growth <- function(x){(x/lag(x)-1)}

totalprcap <- totalprcap %>%
  filter(Country != "World")

rateprcap <- totalprcap %>%
  group_by(Country) %>%
  mutate_each(funs(growth), Prcap)

rateprcap <- rateprcap[-1:-54, ]

#Average growth rate, divided by 50 [(2016-1965)-1]

avgGrowth <- rateprcap %>%
  group_by(Country) %>%
  summarise(AvgGrowth = sum(Prcap/50))
  
  
ratetotal <- energyview %>%
  group_by(Country) %>%
  mutate_each(funs(growth), TotalenergyUse)

ratetotal <- na.omit(ratetotal)

Avgtotal <- ratetotal %>%
  group_by(Country) %>%
  summarise(AvGrowth = sum(TotalenergyUse/50))

#First 5 for rates cap and total

Headratecap <- rateprcap[order(-rateprcap$Prcap), ]
head(unique(Headratecap$Country, 5))

Headtotalcap <- ratetotal[order(-ratetotal$TotalenergyUse), ]
head(unique(Headtotalcap$Country, 5))
```


```{r, include=FALSE}
#Interactive plot for total energy use
plotTotal <- energyview %>%
  SharedData$new(key = ~Country, group = "Select a country") %>%
  plot_ly(x = ~Year, y = ~TotalenergyUse, alpha = 0.5, hoverinfo = "text", text = ~Country) %>%
  group_by(Country) %>%
  add_lines() %>%
  highlight(selectize = TRUE)
plotTotal
```

```{r, include=FALSE}
#Plot for energy pr capita
plotPrcap <- totalprcap %>%
  SharedData$new(key = ~Country, group = "Select a country") %>%
  plot_ly(x = ~Year, y = ~Prcap, alpha = 0.5, hoverinfo = "text", text = ~Country) %>%
  group_by(Country) %>%
  add_lines() %>%
  highlight(selectize = TRUE)

plotPrcap
```


# Consumptions of renewable energy

For our data project we wanted to look on the consumption of renewable energy. We asked us self what we wanted to focus on, and we decided to look closer on the total consumption in the world and the increase in usage of renewable energy.  
  
  
* So we asked us self these questions:  
  + What are the top five countries in renewable energy consumption.
  + What are the top five countries in renewable energy consumption per capita. 
  + What are the top five countries with highest average growth rate in consumption of renewable energy between 1965 and 2016
  + What are the top five countries with highest average growth rate in consumption of renewable energy per capita between 1965 and 2016  
  
  
    
      
But first we think it is wise to clarify where we got our data, and what limitations the data gave us.  

Our source is primarily Oure World Data. The site is run by a subdivision on the University of Oxford, which depends on voluntary donations for its users. The site is primarily a gathering service and gathers information from other scientists, universities and independent people from all over the world, and post the data on their website. All the big data in the project has been taken from this website. The data from this site is up to 2016, and due to some countries lacking information before 1965 we chose to start the dataset from 65’  


After a lot of data-wrangling we manage to make some datasets that was really interesting. The first thing we looked at was the five countries that had the highest consumptions of renewable energy. From this dataset we got that china had the highest consumption in the world, almost twice as much as second place, which was USA. Rest of the list looked like this:

1. China
2. USA
3. Brazil
4. Canada
5. India

When you look at the graph below you can search for the desired country. The graph contains all the countries we had in our dataset.  
  The x-axis tells us how much energy in megawatt that where consumed in a year, and the y-axis shows each year from 65’ to 16’. 

```{r, echo=FALSE, warning=FALSE, message=FALSE}
plotTotal
```

  
What is interesting about the top 5 countries is that the countries either has a fairly large population or a big economy.

#### Per Capita  
  When we look at which countries has the biggest consumption per capita the list changes, only Canada is mention on both rankings but only on second place. Norway tops the ranking, but this is not strange at all considering that the county get 99% of its energy consumption from renewable energy (mainly hydroelectric).  
    From table under you can see the top 5 list for energy consumption in the world and per capita  
      

Top 5 in the world | Top 5 per capita
------------------ | -----------------
             China | Norway
               USA | Canada
            Brazil | Sweden
            Canada | New Zealand
             India | Austria
      
      


  

  
  
  
  
  
  
  
  
  
  

